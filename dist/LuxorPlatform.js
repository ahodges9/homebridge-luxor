"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LuxorPlatform = void 0;
const BaseController_1 = require("./controller/BaseController");
const ControllerFactory_1 = require("./controller/ControllerFactory");
const LightFactory_1 = require("./lights/LightFactory");
const ZD_Light_1 = require("./lights/ZD_Light");
const axios = require('axios').default;
class LuxorPlatform {
    constructor(log, config, api) {
        this.log = log;
        this.config = config;
        this.api = api;
        // this is used to track restored cached accessories
        this.accessories = [];
        this.currGroupsAndThemes = [];
        this.config = config;
        this.log = log;
        this.Service = this.api.hap.Service;
        this.Characteristic = this.api.hap.Characteristic;
        this.Name = config.name;
        this.lastDateAdded = Date.now();
        this.controller = ControllerFactory_1.ControllerFactory.createController({ type: 'base' }, this.log);
        if (api) {
            // Save the API object as plugin needs to register new this.api.platformAccessory via this object.
            this.api = api;
            // Listen to event "didFinishLaunching", this means homebridge already finished loading cached accessories
            // Platform Plugin should only register new this.api.platformAccessory that doesn't exist in homebridge after this event.
            // Or start discover new accessories
            this.api.on('didFinishLaunching', this.didFinishLaunchingAsync.bind(this));
        }
    }
    async sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    // Function invoked when homebridge tries to restore cached accessory
    // Developer can configure accessory at here (like setup event handler)
    configureAccessory(accessory) {
        this.log.debug(`Retrieved cached accessory ${accessory.displayName} with UUID ${accessory.UUID}`);
        this.accessories[accessory.UUID] = accessory;
    }
    async getControllerAsync() {
        // get the name of the controller
        this.log.info(this.Name + ": Starting search for controller at: " + this.config.ipAddr);
        try {
            //Search for controllor and make sure we can find it
            const response = await axios.post(`http://${this.config.ipAddr}/ControllerName.json`);
            let controllerNameData = response.data;
            controllerNameData.ip = this.config.ipAddr;
            controllerNameData.platform = this;
            if (controllerNameData.Controller.substring(0, 5) === 'luxor') {
                controllerNameData.type = BaseController_1.IControllerType.ZD;
            }
            else if (controllerNameData.Controller.substring(0, 5) === 'lxzdc') {
                controllerNameData.type = BaseController_1.IControllerType.ZDC;
            }
            else if (controllerNameData.Controller.substring(0, 5) === 'lxtwo') {
                controllerNameData.type = BaseController_1.IControllerType.ZDTWO;
            }
            else {
                controllerNameData.type = BaseController_1.IControllerType.ZDTWO;
                this.log.info('Found unknown controller named %s of type %s, assuming a ZDTWO', controllerNameData.Controller, controllerNameData.type);
            }
            this.log.info(`Found Controller named ${controllerNameData.Controller} of type ${controllerNameData.type}.`);
            this.controller = ControllerFactory_1.ControllerFactory.createController(controllerNameData, this.log);
        }
        catch (err) {
            this.log.error(this.Name + ' was not able to connect to connect to the controller. ', err);
        }
        ;
    }
    async getControllerGroupListAsync() {
        // Get the list of light groups from the controller
        if (this.config.hideGroups)
            return;
        try {
            let groupLists = await this.controller.GroupListGetAsync();
            this.log.info(`Retrieved ${groupLists.length} light groups from controller.`);
            for (var i in groupLists) {
                this.currGroupsAndThemes.push(groupLists[i]);
            }
        }
        catch (err) {
            this.log.error(`was not able to retrieve light groups from controller.\n${err}\n${err}`);
        }
        ;
    }
    async getControllerThemeListAsync() {
        // Get the list of light LuxorThemes from the controller
        try {
            let themeLists = await this.controller.ThemeListGetAsync();
            this.log.info(`Retrieved ${themeLists.length} themes from controller.`);
            themeLists.push({
                Name: 'Illuminate all lights',
                ThemeIndex: 100,
                OnOff: 0,
                isOn: false,
                type: ZD_Light_1.ILightType.THEME
            });
            themeLists.push({
                Name: 'Extinguish all lights',
                ThemeIndex: 101,
                OnOff: 0,
                isOn: false,
                type: ZD_Light_1.ILightType.THEME
            });
            for (var i in themeLists) {
                themeLists[i].type = ZD_Light_1.ILightType.THEME;
                this.currGroupsAndThemes.push(themeLists[i]);
            }
        }
        catch (err) {
            this.log.error('was not able to retrieve light themes from controller.', err);
        }
        ;
    }
    removeAccessories() {
        for (var UUID in this.accessories) {
            let accessory = this.accessories[UUID];
            if (typeof this.config.removeAllAccessories !== 'undefined' && this.config.removeAllAccessories || typeof this.config.removeAccessories !== 'undefined' && this.config.removeAccessories.includes(accessory.UUID)) {
                this.log.info(`Removing cached accessory ${accessory.displayName} with UUID ${accessory.UUID} per platform configuration settings.`);
                this.api.unregisterPlatformAccessories("homebridge-luxor", "Luxor", [accessory]);
                this.accessories = this.accessories.filter(item => item.UUID !== UUID);
            }
            ;
        }
    }
    addGroupAccessory(lightGroup) {
        var accessory = new this.api.platformAccessory(lightGroup.Name, lightGroup.UUID);
        let context = {
            lastDateAdded: this.lastDateAdded,
            color: lightGroup.Color,
            groupNumber: lightGroup.GroupNumber,
            brightness: lightGroup.Intensity,
            type: lightGroup.type,
            isOn: lightGroup.Intensity > 0,
            independentColors: this.config.independentColors
        };
        accessory.context = context;
        LightFactory_1.LightFactory.createLight(this, accessory);
        this.api.registerPlatformAccessories("homebridge-luxor", "Luxor", [accessory]);
    }
    addThemeAccessory(themeGroup) {
        var accessory = new this.api.platformAccessory(themeGroup.Name, themeGroup.UUID);
        let context = {
            lastDateAdded: this.lastDateAdded,
            type: ZD_Light_1.ILightType.THEME,
            isOn: themeGroup.OnOff === 1,
            themeIndex: themeGroup.ThemeIndex,
            OnOff: themeGroup.OnOff
        };
        accessory.context = context;
        LightFactory_1.LightFactory.createLight(this, accessory);
        this.accessories[accessory.UUID] = accessory;
        this.api.registerPlatformAccessories("homebridge-luxor", "Luxor", [accessory]);
    }
    assignUUIDs() {
        for (let i = 0; i < this.currGroupsAndThemes.length; i++) {
            let acc = this.currGroupsAndThemes[i];
            if (typeof acc.ThemeIndex !== 'undefined') {
                acc.UUID = this.api.hap.uuid.generate('luxor.' + `theme-${acc.ThemeIndex}`);
            }
            else {
                acc.UUID = this.api.hap.uuid.generate('luxor.' + `group.-${acc.GroupNumber}`);
            }
        }
    }
    async processAccessories() {
        this.assignUUIDs();
        this.removeAccessories();
        for (var UUID in this.accessories) {
            let cachedAcc = this.accessories[UUID];
            // look for match on current devices
            let remove = true;
            for (let j = 0; j < this.currGroupsAndThemes.length; j++) {
                let currAcc = this.currGroupsAndThemes[j];
                if (cachedAcc.UUID === currAcc.UUID) {
                    // found existing device
                    this.log.info(`Loading cached accessory ${cachedAcc.displayName} with UUID ${cachedAcc.UUID}.`);
                    // update cached device (name, etc)
                    let context = cachedAcc.context;
                    context.lastDateAdded = this.lastDateAdded;
                    if (typeof currAcc.Color !== 'undefined')
                        context.color = currAcc.Color;
                    if (typeof currAcc.GroupNumber !== 'undefined')
                        context.groupNumber = currAcc.GroupNumber;
                    if (typeof currAcc.ThemeIndex !== 'undefined')
                        context.themeIndex = currAcc.ThemeIndex;
                    if (typeof currAcc.Intensity !== 'undefined') {
                        context.brightness = currAcc.Intensity;
                        context.isOn = currAcc.Intensity > 0;
                    }
                    if (typeof currAcc.type !== 'undefined')
                        context.type = currAcc.type;
                    if (typeof currAcc.isOn !== 'undefined')
                        context.isOn = currAcc.isOn;
                    if (typeof currAcc.Name !== 'undefined')
                        cachedAcc.displayName = currAcc.Name;
                    cachedAcc.context = context;
                    this.api.updatePlatformAccessories([cachedAcc]);
                    LightFactory_1.LightFactory.createLight(this, cachedAcc);
                    this.currGroupsAndThemes.splice(j, 1);
                    remove = false;
                    break;
                }
            }
            // remove the cachedAcc that can't be matched
            if (remove) {
                this.log.info(`Removing cached accessory ${cachedAcc.displayName} with UUID ${cachedAcc.UUID}.`);
                this.api.unregisterPlatformAccessories("homebridge-luxor", "Luxor", [cachedAcc]);
            }
        }
        // add any new accessories that were not previously matched
        if (this.currGroupsAndThemes.length > 0) {
            for (let j = 0; j < this.currGroupsAndThemes.length; j++) {
                let currAcc = this.currGroupsAndThemes[j];
                this.log.info(`Adding new accessory ${currAcc.Name} with UUID ${currAcc.UUID}.`);
                if (currAcc.type === ZD_Light_1.ILightType.THEME)
                    this.addThemeAccessory(currAcc);
                else
                    this.addGroupAccessory(currAcc);
            }
        }
    }
    async didFinishLaunchingAsync() {
        if (!this.config.ipAddr) {
            this.log.error(this.Name + " needs an IP Address in the config file.  Please see sample_config.json.");
        }
        try {
            await this.getControllerAsync();
            //this.retrieveCachedAccessories();
            await this.getControllerGroupListAsync();
            await this.getControllerThemeListAsync();
            await this.processAccessories();
            // this.removeOphanedAccessories();
            this.log.info('Finished initializing');
        }
        catch (err) {
            this.log.error('Error in didFinishLaunching', err);
        }
        ;
    }
}
exports.LuxorPlatform = LuxorPlatform;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTHV4b3JQbGF0Zm9ybS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9MdXhvclBsYXRmb3JtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUlBLGdFQUFzRztBQUN0RyxzRUFBbUU7QUFDbkUsd0RBQXFEO0FBRXJELGdEQUErQztBQUUvQyxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBR3ZDLE1BQWEsYUFBYTtJQVV0QixZQUNvQixHQUFXLEVBQ1gsTUFBc0IsRUFDdEIsR0FBUTtRQUZSLFFBQUcsR0FBSCxHQUFHLENBQVE7UUFDWCxXQUFNLEdBQU4sTUFBTSxDQUFnQjtRQUN0QixRQUFHLEdBQUgsR0FBRyxDQUFLO1FBWjVCLG9EQUFvRDtRQUM3QyxnQkFBVyxHQUF3QixFQUFFLENBQUM7UUFNckMsd0JBQW1CLEdBQWdDLEVBQUUsQ0FBQztRQU8xRCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNmLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDO1FBQ2xELElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNoQyxJQUFJLENBQUMsVUFBVSxHQUFHLHFDQUFpQixDQUFDLGdCQUFnQixDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoRixJQUFJLEdBQUcsRUFBRTtZQUNMLGtHQUFrRztZQUNsRyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FB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QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFjY2VzcyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IEFQSSwgQ2hhcmFjdGVyaXN0aWMsIER5bmFtaWNQbGF0Zm9ybVBsdWdpbiwgTG9nZ2VyLCBQbGF0Zm9ybUFjY2Vzc29yeSwgUGxhdGZvcm1Db25maWcsIFNlcnZpY2UgfSBmcm9tICdob21lYnJpZGdlJztcbmltcG9ydCB7IGN3ZCB9IGZyb20gJ3Byb2Nlc3MnO1xuXG5pbXBvcnQgeyBCYXNlQ29udHJvbGxlciwgSUNvbnRyb2xsZXJUeXBlLCBJR3JvdXBMaXN0LCBJVGhlbWVMaXN0IH0gZnJvbSAnLi9jb250cm9sbGVyL0Jhc2VDb250cm9sbGVyJztcbmltcG9ydCB7IENvbnRyb2xsZXJGYWN0b3J5IH0gZnJvbSAnLi9jb250cm9sbGVyL0NvbnRyb2xsZXJGYWN0b3J5JztcbmltcG9ydCB7IExpZ2h0RmFjdG9yeSB9IGZyb20gJy4vbGlnaHRzL0xpZ2h0RmFjdG9yeSc7XG5pbXBvcnQgeyBUaGVtZSB9IGZyb20gJy4vbGlnaHRzL1RoZW1lJztcbmltcG9ydCB7IElMaWdodFR5cGUgfSBmcm9tICcuL2xpZ2h0cy9aRF9MaWdodCc7XG5cbmNvbnN0IGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKS5kZWZhdWx0O1xuXG5cbmV4cG9ydCBjbGFzcyBMdXhvclBsYXRmb3JtIGltcGxlbWVudHMgRHluYW1pY1BsYXRmb3JtUGx1Z2luIHtcbiAgICAvLyB0aGlzIGlzIHVzZWQgdG8gdHJhY2sgcmVzdG9yZWQgY2FjaGVkIGFjY2Vzc29yaWVzXG4gICAgcHVibGljIGFjY2Vzc29yaWVzOiBQbGF0Zm9ybUFjY2Vzc29yeVtdID0gW107XG4gICAgcHVibGljIGNvbnRyb2xsZXI6IEJhc2VDb250cm9sbGVyOy8vIHdpbGwgYmUgYXNzaWduZWQgdG8gWkQgb3IgWkRDIGNvbnRyb2xsZXJcbiAgICBwdWJsaWMgTmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyBsYXN0RGF0ZUFkZGVkOiBudW1iZXI7XG4gICAgcHVibGljIHJlYWRvbmx5IFNlcnZpY2U6IHR5cGVvZiBTZXJ2aWNlO1xuICAgIHB1YmxpYyByZWFkb25seSBDaGFyYWN0ZXJpc3RpYzogdHlwZW9mIENoYXJhY3RlcmlzdGljO1xuICAgIHByaXZhdGUgY3Vyckdyb3Vwc0FuZFRoZW1lczogSUdyb3VwTGlzdFtdICYgSVRoZW1lTGlzdFtdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGxvZzogTG9nZ2VyLFxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgY29uZmlnOiBQbGF0Zm9ybUNvbmZpZyxcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGFwaTogQVBJXG4gICAgKSB7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLmxvZyA9IGxvZztcbiAgICAgICAgdGhpcy5TZXJ2aWNlID0gdGhpcy5hcGkuaGFwLlNlcnZpY2U7XG4gICAgICAgIHRoaXMuQ2hhcmFjdGVyaXN0aWMgPSB0aGlzLmFwaS5oYXAuQ2hhcmFjdGVyaXN0aWM7XG4gICAgICAgIHRoaXMuTmFtZSA9IGNvbmZpZy5uYW1lO1xuICAgICAgICB0aGlzLmxhc3REYXRlQWRkZWQgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBDb250cm9sbGVyRmFjdG9yeS5jcmVhdGVDb250cm9sbGVyKHsgdHlwZTogJ2Jhc2UnIH0sIHRoaXMubG9nKVxuXG4gICAgICAgIGlmIChhcGkpIHtcbiAgICAgICAgICAgIC8vIFNhdmUgdGhlIEFQSSBvYmplY3QgYXMgcGx1Z2luIG5lZWRzIHRvIHJlZ2lzdGVyIG5ldyB0aGlzLmFwaS5wbGF0Zm9ybUFjY2Vzc29yeSB2aWEgdGhpcyBvYmplY3QuXG4gICAgICAgICAgICB0aGlzLmFwaSA9IGFwaTtcblxuICAgICAgICAgICAgLy8gTGlzdGVuIHRvIGV2ZW50IFwiZGlkRmluaXNoTGF1bmNoaW5nXCIsIHRoaXMgbWVhbnMgaG9tZWJyaWRnZSBhbHJlYWR5IGZpbmlzaGVkIGxvYWRpbmcgY2FjaGVkIGFjY2Vzc29yaWVzXG4gICAgICAgICAgICAvLyBQbGF0Zm9ybSBQbHVnaW4gc2hvdWxkIG9ubHkgcmVnaXN0ZXIgbmV3IHRoaXMuYXBpLnBsYXRmb3JtQWNjZXNzb3J5IHRoYXQgZG9lc24ndCBleGlzdCBpbiBob21lYnJpZGdlIGFmdGVyIHRoaXMgZXZlbnQuXG4gICAgICAgICAgICAvLyBPciBzdGFydCBkaXNjb3ZlciBuZXcgYWNjZXNzb3JpZXNcbiAgICAgICAgICAgIHRoaXMuYXBpLm9uKCdkaWRGaW5pc2hMYXVuY2hpbmcnLCB0aGlzLmRpZEZpbmlzaExhdW5jaGluZ0FzeW5jLmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHNsZWVwKG1zKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgICB9XG4gICAgLy8gRnVuY3Rpb24gaW52b2tlZCB3aGVuIGhvbWVicmlkZ2UgdHJpZXMgdG8gcmVzdG9yZSBjYWNoZWQgYWNjZXNzb3J5XG4gICAgLy8gRGV2ZWxvcGVyIGNhbiBjb25maWd1cmUgYWNjZXNzb3J5IGF0IGhlcmUgKGxpa2Ugc2V0dXAgZXZlbnQgaGFuZGxlcilcbiAgICBjb25maWd1cmVBY2Nlc3NvcnkoYWNjZXNzb3J5OiBQbGF0Zm9ybUFjY2Vzc29yeSkge1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgUmV0cmlldmVkIGNhY2hlZCBhY2Nlc3NvcnkgJHthY2Nlc3NvcnkuZGlzcGxheU5hbWV9IHdpdGggVVVJRCAke2FjY2Vzc29yeS5VVUlEfWApO1xuICAgICAgICB0aGlzLmFjY2Vzc29yaWVzW2FjY2Vzc29yeS5VVUlEXSA9IGFjY2Vzc29yeTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0Q29udHJvbGxlckFzeW5jKCkge1xuICAgICAgICAvLyBnZXQgdGhlIG5hbWUgb2YgdGhlIGNvbnRyb2xsZXJcblxuICAgICAgICB0aGlzLmxvZy5pbmZvKHRoaXMuTmFtZSArIFwiOiBTdGFydGluZyBzZWFyY2ggZm9yIGNvbnRyb2xsZXIgYXQ6IFwiICsgdGhpcy5jb25maWcuaXBBZGRyKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vU2VhcmNoIGZvciBjb250cm9sbG9yIGFuZCBtYWtlIHN1cmUgd2UgY2FuIGZpbmQgaXRcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgICAgICAgICAgICBgaHR0cDovLyR7dGhpcy5jb25maWcuaXBBZGRyfS9Db250cm9sbGVyTmFtZS5qc29uYFxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICBsZXQgY29udHJvbGxlck5hbWVEYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIGNvbnRyb2xsZXJOYW1lRGF0YS5pcCA9IHRoaXMuY29uZmlnLmlwQWRkcjtcbiAgICAgICAgICAgIGNvbnRyb2xsZXJOYW1lRGF0YS5wbGF0Zm9ybSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoY29udHJvbGxlck5hbWVEYXRhLkNvbnRyb2xsZXIuc3Vic3RyaW5nKDAsIDUpID09PSAnbHV4b3InKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlck5hbWVEYXRhLnR5cGUgPSBJQ29udHJvbGxlclR5cGUuWkQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRyb2xsZXJOYW1lRGF0YS5Db250cm9sbGVyLnN1YnN0cmluZygwLCA1KSA9PT0gJ2x4emRjJykge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJOYW1lRGF0YS50eXBlID0gSUNvbnRyb2xsZXJUeXBlLlpEQztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udHJvbGxlck5hbWVEYXRhLkNvbnRyb2xsZXIuc3Vic3RyaW5nKDAsIDUpID09PSAnbHh0d28nKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlck5hbWVEYXRhLnR5cGUgPSBJQ29udHJvbGxlclR5cGUuWkRUV087XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJOYW1lRGF0YS50eXBlID0gSUNvbnRyb2xsZXJUeXBlLlpEVFdPO1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmluZm8oJ0ZvdW5kIHVua25vd24gY29udHJvbGxlciBuYW1lZCAlcyBvZiB0eXBlICVzLCBhc3N1bWluZyBhIFpEVFdPJywgY29udHJvbGxlck5hbWVEYXRhLkNvbnRyb2xsZXIsIGNvbnRyb2xsZXJOYW1lRGF0YS50eXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubG9nLmluZm8oYEZvdW5kIENvbnRyb2xsZXIgbmFtZWQgJHtjb250cm9sbGVyTmFtZURhdGEuQ29udHJvbGxlcn0gb2YgdHlwZSAke2NvbnRyb2xsZXJOYW1lRGF0YS50eXBlfS5gKTtcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlciA9IENvbnRyb2xsZXJGYWN0b3J5LmNyZWF0ZUNvbnRyb2xsZXIoY29udHJvbGxlck5hbWVEYXRhLCB0aGlzLmxvZyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IodGhpcy5OYW1lICsgJyB3YXMgbm90IGFibGUgdG8gY29ubmVjdCB0byBjb25uZWN0IHRvIHRoZSBjb250cm9sbGVyLiAnLCBlcnIpO1xuICAgICAgICB9O1xuXG4gICAgfVxuICAgIGFzeW5jIGdldENvbnRyb2xsZXJHcm91cExpc3RBc3luYygpIHtcbiAgICAgICAgLy8gR2V0IHRoZSBsaXN0IG9mIGxpZ2h0IGdyb3VwcyBmcm9tIHRoZSBjb250cm9sbGVyXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5oaWRlR3JvdXBzKSByZXR1cm47XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgZ3JvdXBMaXN0cyA9IGF3YWl0IHRoaXMuY29udHJvbGxlci5Hcm91cExpc3RHZXRBc3luYygpO1xuICAgICAgICAgICAgdGhpcy5sb2cuaW5mbyhgUmV0cmlldmVkICR7Z3JvdXBMaXN0cy5sZW5ndGh9IGxpZ2h0IGdyb3VwcyBmcm9tIGNvbnRyb2xsZXIuYCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIGdyb3VwTGlzdHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJHcm91cHNBbmRUaGVtZXMucHVzaChncm91cExpc3RzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmxvZy5lcnJvcihgd2FzIG5vdCBhYmxlIHRvIHJldHJpZXZlIGxpZ2h0IGdyb3VwcyBmcm9tIGNvbnRyb2xsZXIuXFxuJHtlcnJ9XFxuJHtlcnJ9YCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGFzeW5jIGdldENvbnRyb2xsZXJUaGVtZUxpc3RBc3luYygpIHtcbiAgICAgICAgLy8gR2V0IHRoZSBsaXN0IG9mIGxpZ2h0IEx1eG9yVGhlbWVzIGZyb20gdGhlIGNvbnRyb2xsZXJcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCB0aGVtZUxpc3RzID0gYXdhaXQgdGhpcy5jb250cm9sbGVyLlRoZW1lTGlzdEdldEFzeW5jKCk7XG4gICAgICAgICAgICB0aGlzLmxvZy5pbmZvKGBSZXRyaWV2ZWQgJHt0aGVtZUxpc3RzLmxlbmd0aH0gdGhlbWVzIGZyb20gY29udHJvbGxlci5gKTtcblxuICAgICAgICAgICAgdGhlbWVMaXN0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICBOYW1lOiAnSWxsdW1pbmF0ZSBhbGwgbGlnaHRzJyxcbiAgICAgICAgICAgICAgICBUaGVtZUluZGV4OiAxMDAsXG4gICAgICAgICAgICAgICAgT25PZmY6IDAsXG4gICAgICAgICAgICAgICAgaXNPbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgdHlwZTogSUxpZ2h0VHlwZS5USEVNRVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGVtZUxpc3RzLnB1c2goe1xuICAgICAgICAgICAgICAgIE5hbWU6ICdFeHRpbmd1aXNoIGFsbCBsaWdodHMnLFxuICAgICAgICAgICAgICAgIFRoZW1lSW5kZXg6IDEwMSxcbiAgICAgICAgICAgICAgICBPbk9mZjogMCxcbiAgICAgICAgICAgICAgICBpc09uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBJTGlnaHRUeXBlLlRIRU1FXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhlbWVMaXN0cykge1xuICAgICAgICAgICAgICAgIHRoZW1lTGlzdHNbaV0udHlwZSA9IElMaWdodFR5cGUuVEhFTUU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyR3JvdXBzQW5kVGhlbWVzLnB1c2godGhlbWVMaXN0c1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IoJ3dhcyBub3QgYWJsZSB0byByZXRyaWV2ZSBsaWdodCB0aGVtZXMgZnJvbSBjb250cm9sbGVyLicsIGVycik7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmVtb3ZlQWNjZXNzb3JpZXMoKSB7XG4gICAgICAgIGZvciAodmFyIFVVSUQgaW4gdGhpcy5hY2Nlc3Nvcmllcykge1xuICAgICAgICAgICAgbGV0IGFjY2Vzc29yeSA9IHRoaXMuYWNjZXNzb3JpZXNbVVVJRF07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuY29uZmlnLnJlbW92ZUFsbEFjY2Vzc29yaWVzICE9PSAndW5kZWZpbmVkJyAmJiB0aGlzLmNvbmZpZy5yZW1vdmVBbGxBY2Nlc3NvcmllcyB8fCB0eXBlb2YgdGhpcy5jb25maWcucmVtb3ZlQWNjZXNzb3JpZXMgIT09ICd1bmRlZmluZWQnICYmIHRoaXMuY29uZmlnLnJlbW92ZUFjY2Vzc29yaWVzLmluY2x1ZGVzKGFjY2Vzc29yeS5VVUlEKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmluZm8oYFJlbW92aW5nIGNhY2hlZCBhY2Nlc3NvcnkgJHthY2Nlc3NvcnkuZGlzcGxheU5hbWV9IHdpdGggVVVJRCAke2FjY2Vzc29yeS5VVUlEfSBwZXIgcGxhdGZvcm0gY29uZmlndXJhdGlvbiBzZXR0aW5ncy5gKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwaS51bnJlZ2lzdGVyUGxhdGZvcm1BY2Nlc3NvcmllcyhcImhvbWVicmlkZ2UtbHV4b3JcIiwgXCJMdXhvclwiLCBbYWNjZXNzb3J5XSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hY2Nlc3NvcmllcyA9IHRoaXMuYWNjZXNzb3JpZXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5VVUlEICE9PSBVVUlEKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRHcm91cEFjY2Vzc29yeShsaWdodEdyb3VwOiBJR3JvdXBMaXN0KSB7XG4gICAgICAgIHZhciBhY2Nlc3NvcnkgPSBuZXcgdGhpcy5hcGkucGxhdGZvcm1BY2Nlc3NvcnkobGlnaHRHcm91cC5OYW1lLCBsaWdodEdyb3VwLlVVSUQpO1xuICAgICAgICBsZXQgY29udGV4dDogSUNvbnRleHQgPSB7XG4gICAgICAgICAgICBsYXN0RGF0ZUFkZGVkOiB0aGlzLmxhc3REYXRlQWRkZWQsXG4gICAgICAgICAgICBjb2xvcjogbGlnaHRHcm91cC5Db2xvcixcbiAgICAgICAgICAgIGdyb3VwTnVtYmVyOiBsaWdodEdyb3VwLkdyb3VwTnVtYmVyLFxuICAgICAgICAgICAgYnJpZ2h0bmVzczogbGlnaHRHcm91cC5JbnRlbnNpdHksXG4gICAgICAgICAgICB0eXBlOiBsaWdodEdyb3VwLnR5cGUsXG4gICAgICAgICAgICBpc09uOiBsaWdodEdyb3VwLkludGVuc2l0eSA+IDAsXG4gICAgICAgICAgICBpbmRlcGVuZGVudENvbG9yczogdGhpcy5jb25maWcuaW5kZXBlbmRlbnRDb2xvcnNcbiAgICAgICAgfVxuICAgICAgICBhY2Nlc3NvcnkuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgIExpZ2h0RmFjdG9yeS5jcmVhdGVMaWdodCh0aGlzLCBhY2Nlc3NvcnkpO1xuICAgICAgICB0aGlzLmFwaS5yZWdpc3RlclBsYXRmb3JtQWNjZXNzb3JpZXMoXCJob21lYnJpZGdlLWx1eG9yXCIsIFwiTHV4b3JcIiwgW2FjY2Vzc29yeV0pO1xuICAgIH1cblxuICAgIGFkZFRoZW1lQWNjZXNzb3J5KHRoZW1lR3JvdXA6IElUaGVtZUxpc3QpIHtcbiAgICAgICAgdmFyIGFjY2Vzc29yeSA9IG5ldyB0aGlzLmFwaS5wbGF0Zm9ybUFjY2Vzc29yeSh0aGVtZUdyb3VwLk5hbWUsIHRoZW1lR3JvdXAuVVVJRCk7XG4gICAgICAgIGxldCBjb250ZXh0OiBJQ29udGV4dCA9IHtcbiAgICAgICAgICAgIGxhc3REYXRlQWRkZWQ6IHRoaXMubGFzdERhdGVBZGRlZCxcbiAgICAgICAgICAgIHR5cGU6IElMaWdodFR5cGUuVEhFTUUsXG4gICAgICAgICAgICBpc09uOiB0aGVtZUdyb3VwLk9uT2ZmID09PSAxLFxuICAgICAgICAgICAgdGhlbWVJbmRleDogdGhlbWVHcm91cC5UaGVtZUluZGV4LFxuICAgICAgICAgICAgT25PZmY6IHRoZW1lR3JvdXAuT25PZmZcbiAgICAgICAgfVxuICAgICAgICBhY2Nlc3NvcnkuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgIExpZ2h0RmFjdG9yeS5jcmVhdGVMaWdodCh0aGlzLCBhY2Nlc3NvcnkpO1xuICAgICAgICB0aGlzLmFjY2Vzc29yaWVzW2FjY2Vzc29yeS5VVUlEXSA9IGFjY2Vzc29yeTtcbiAgICAgICAgdGhpcy5hcGkucmVnaXN0ZXJQbGF0Zm9ybUFjY2Vzc29yaWVzKFwiaG9tZWJyaWRnZS1sdXhvclwiLCBcIkx1eG9yXCIsIFthY2Nlc3NvcnldKTtcbiAgICB9XG5cbiAgICBhc3NpZ25VVUlEcygpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmN1cnJHcm91cHNBbmRUaGVtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBhY2MgPSB0aGlzLmN1cnJHcm91cHNBbmRUaGVtZXNbaV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIGFjYy5UaGVtZUluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGFjYy5VVUlEID0gdGhpcy5hcGkuaGFwLnV1aWQuZ2VuZXJhdGUoJ2x1eG9yLicgKyBgdGhlbWUtJHthY2MuVGhlbWVJbmRleH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFjYy5VVUlEID0gdGhpcy5hcGkuaGFwLnV1aWQuZ2VuZXJhdGUoJ2x1eG9yLicgKyBgZ3JvdXAuLSR7YWNjLkdyb3VwTnVtYmVyfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgcHJvY2Vzc0FjY2Vzc29yaWVzKCkge1xuICAgICAgICB0aGlzLmFzc2lnblVVSURzKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlQWNjZXNzb3JpZXMoKVxuICAgICAgICBmb3IgKHZhciBVVUlEIGluIHRoaXMuYWNjZXNzb3JpZXMpIHtcbiAgICAgICAgICAgIGxldCBjYWNoZWRBY2MgPSB0aGlzLmFjY2Vzc29yaWVzW1VVSURdO1xuICAgICAgICAgICAgLy8gbG9vayBmb3IgbWF0Y2ggb24gY3VycmVudCBkZXZpY2VzXG4gICAgICAgICAgICBsZXQgcmVtb3ZlID0gdHJ1ZTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5jdXJyR3JvdXBzQW5kVGhlbWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJBY2MgPSB0aGlzLmN1cnJHcm91cHNBbmRUaGVtZXNbal07XG4gICAgICAgICAgICAgICAgaWYgKGNhY2hlZEFjYy5VVUlEID09PSBjdXJyQWNjLlVVSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZm91bmQgZXhpc3RpbmcgZGV2aWNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nLmluZm8oYExvYWRpbmcgY2FjaGVkIGFjY2Vzc29yeSAke2NhY2hlZEFjYy5kaXNwbGF5TmFtZX0gd2l0aCBVVUlEICR7Y2FjaGVkQWNjLlVVSUR9LmApO1xuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2FjaGVkIGRldmljZSAobmFtZSwgZXRjKVxuICAgICAgICAgICAgICAgICAgICBsZXQgY29udGV4dDogSUNvbnRleHQgPSBjYWNoZWRBY2MuY29udGV4dCBhcyBJQ29udGV4dDtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sYXN0RGF0ZUFkZGVkID0gdGhpcy5sYXN0RGF0ZUFkZGVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJBY2MuQ29sb3IgIT09ICd1bmRlZmluZWQnKSBjb250ZXh0LmNvbG9yID0gY3VyckFjYy5Db2xvcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyQWNjLkdyb3VwTnVtYmVyICE9PSAndW5kZWZpbmVkJykgY29udGV4dC5ncm91cE51bWJlciA9IGN1cnJBY2MuR3JvdXBOdW1iZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3VyckFjYy5UaGVtZUluZGV4ICE9PSAndW5kZWZpbmVkJykgY29udGV4dC50aGVtZUluZGV4ID0gY3VyckFjYy5UaGVtZUluZGV4O1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJBY2MuSW50ZW5zaXR5ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5icmlnaHRuZXNzID0gY3VyckFjYy5JbnRlbnNpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmlzT24gPSBjdXJyQWNjLkludGVuc2l0eSA+IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyQWNjLnR5cGUgIT09ICd1bmRlZmluZWQnKSBjb250ZXh0LnR5cGUgPSBjdXJyQWNjLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3VyckFjYy5pc09uICE9PSAndW5kZWZpbmVkJykgY29udGV4dC5pc09uID0gY3VyckFjYy5pc09uO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJBY2MuTmFtZSAhPT0gJ3VuZGVmaW5lZCcpIGNhY2hlZEFjYy5kaXNwbGF5TmFtZSA9IGN1cnJBY2MuTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVkQWNjLmNvbnRleHQgPSBjb250ZXh0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwaS51cGRhdGVQbGF0Zm9ybUFjY2Vzc29yaWVzKFtjYWNoZWRBY2NdKTtcbiAgICAgICAgICAgICAgICAgICAgTGlnaHRGYWN0b3J5LmNyZWF0ZUxpZ2h0KHRoaXMsIGNhY2hlZEFjYyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3Vyckdyb3Vwc0FuZFRoZW1lcy5zcGxpY2UoaiwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyByZW1vdmUgdGhlIGNhY2hlZEFjYyB0aGF0IGNhbid0IGJlIG1hdGNoZWRcbiAgICAgICAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5pbmZvKGBSZW1vdmluZyBjYWNoZWQgYWNjZXNzb3J5ICR7Y2FjaGVkQWNjLmRpc3BsYXlOYW1lfSB3aXRoIFVVSUQgJHtjYWNoZWRBY2MuVVVJRH0uYCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcGkudW5yZWdpc3RlclBsYXRmb3JtQWNjZXNzb3JpZXMoXCJob21lYnJpZGdlLWx1eG9yXCIsIFwiTHV4b3JcIiwgW2NhY2hlZEFjY10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGFkZCBhbnkgbmV3IGFjY2Vzc29yaWVzIHRoYXQgd2VyZSBub3QgcHJldmlvdXNseSBtYXRjaGVkXG4gICAgICAgIGlmICh0aGlzLmN1cnJHcm91cHNBbmRUaGVtZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmN1cnJHcm91cHNBbmRUaGVtZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgY3VyckFjYyA9IHRoaXMuY3Vyckdyb3Vwc0FuZFRoZW1lc1tqXTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5pbmZvKGBBZGRpbmcgbmV3IGFjY2Vzc29yeSAke2N1cnJBY2MuTmFtZX0gd2l0aCBVVUlEICR7Y3VyckFjYy5VVUlEfS5gKTtcbiAgICAgICAgICAgICAgICBpZiAoY3VyckFjYy50eXBlID09PSBJTGlnaHRUeXBlLlRIRU1FKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFRoZW1lQWNjZXNzb3J5KGN1cnJBY2MpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRHcm91cEFjY2Vzc29yeShjdXJyQWNjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGRpZEZpbmlzaExhdW5jaGluZ0FzeW5jKCkge1xuICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmlwQWRkcikge1xuICAgICAgICAgICAgdGhpcy5sb2cuZXJyb3IodGhpcy5OYW1lICsgXCIgbmVlZHMgYW4gSVAgQWRkcmVzcyBpbiB0aGUgY29uZmlnIGZpbGUuICBQbGVhc2Ugc2VlIHNhbXBsZV9jb25maWcuanNvbi5cIik7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0Q29udHJvbGxlckFzeW5jKCk7XG4gICAgICAgICAgICAvL3RoaXMucmV0cmlldmVDYWNoZWRBY2Nlc3NvcmllcygpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRDb250cm9sbGVyR3JvdXBMaXN0QXN5bmMoKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0Q29udHJvbGxlclRoZW1lTGlzdEFzeW5jKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NBY2Nlc3NvcmllcygpO1xuICAgICAgICAgICAgLy8gdGhpcy5yZW1vdmVPcGhhbmVkQWNjZXNzb3JpZXMoKTtcbiAgICAgICAgICAgIHRoaXMubG9nLmluZm8oJ0ZpbmlzaGVkIGluaXRpYWxpemluZycpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMubG9nLmVycm9yKCdFcnJvciBpbiBkaWRGaW5pc2hMYXVuY2hpbmcnLCBlcnIpO1xuICAgICAgICB9O1xuICAgIH1cbn1cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbnRleHQge1xuICAgIGxhc3REYXRlQWRkZWQ6IG51bWJlcjtcbiAgICBncm91cE51bWJlcj86IG51bWJlcjtcbiAgICBicmlnaHRuZXNzPzogbnVtYmVyO1xuICAgIHR5cGU6IElMaWdodFR5cGVcbiAgICBjb2xvcj86IG51bWJlcjtcbiAgICBzdGF0dXM/OiBhbnk7XG4gICAgaXNPbjogYm9vbGVhbjtcbiAgICBodWU/OiBudW1iZXI7XG4gICAgc2F0dXJhdGlvbj86IG51bWJlcjtcbiAgICB0aGVtZUluZGV4PzogbnVtYmVyO1xuICAgIE9uT2ZmPzogMCB8IDE7XG4gICAgaW5kZXBlbmRlbnRDb2xvcnM/OiBib29sZWFuO1xufSJdfQ==